<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø®ÙŠØ±Ø§ØªÙ†Ø§ | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
--primary:#27ae60;
--accent:#f39c12;
--bg:#f8fafc;
--text:#1e293b;
}

*{
box-sizing:border-box;
margin:0;
padding:0;
font-family:'Cairo',sans-serif;
}

body{
background:var(--bg);
padding-top:90px;
}

header{
background:white;
height:80px;
position:fixed;
top:0;
width:100%;
z-index:9999;
display:flex;
justify-content:space-between;
align-items:center;
padding:0 5%;
box-shadow:0 2px 10px rgba(0,0,0,0.1);
}

.logo{
font-size:1.8rem;
font-weight:800;
color:var(--primary);
}

.btn{
padding:10px 20px;
border:none;
border-radius:10px;
cursor:pointer;
font-weight:bold;
}

.btn-primary{
background:var(--primary);
color:white;
}

.products{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
gap:20px;
padding:40px 5%;
}

.card{
background:white;
border-radius:20px;
padding:15px;
box-shadow:0 5px 15px rgba(0,0,0,0.05);
}

.card img{
width:100%;
height:180px;
object-fit:cover;
border-radius:15px;
margin-bottom:10px;
}

.card h3{
margin-bottom:5px;
}

.price{
color:var(--primary);
font-weight:bold;
}

.modal{
display:none;
position:fixed;
inset:0;
background:rgba(0,0,0,0.6);
z-index:10000;
align-items:center;
justify-content:center;
backdrop-filter:blur(5px);
}

.modal-content{
background:white;
padding:30px;
border-radius:20px;
width:90%;
max-width:400px;
}

input,select{
width:100%;
padding:12px;
margin-bottom:15px;
border-radius:10px;
border:2px solid #eee;
}

#floatingAddBtn{
position:fixed;
bottom:30px;
right:30px;
width:60px;
height:60px;
background:var(--accent);
color:white;
border-radius:50%;
display:none;
align-items:center;
justify-content:center;
font-size:1.5rem;
cursor:pointer;
box-shadow:0 4px 15px rgba(0,0,0,0.2);
z-index:9000;
}
</style>
</head>

<body>

<header>
<div class="logo">Ø®ÙŠØ±Ø§ØªÙ†Ø§ ğŸŒ¿</div>

<div id="navActions">
<button class="btn btn-primary" onclick="openM('authModal')">Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„</button>
</div>

<div id="userProfile" style="display:none;">
<button class="btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>
</header>

<!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<div class="products" id="productsContainer"></div>

<!-- Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="authModal" class="modal">
<div class="modal-content">

<h3 style="margin-bottom:15px;">ØªØ³Ø¬ÙŠÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h3>

<input type="text" id="regName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ (ÙÙŠ Ø­Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„)">
<select id="regRole">
<option value="user">Ø£Ù†Ø§ Ø²Ø¨ÙˆÙ†</option>
<option value="seller">Ø£Ù†Ø§ Ø¨Ø§Ø¦Ø¹</option>
</select>

<input type="email" id="authEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
<input type="password" id="authPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

<button class="btn btn-primary" onclick="handleAuth()">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
<p onclick="closeM('authModal')" style="text-align:center;margin-top:10px;cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</p>

</div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
<div id="productModal" class="modal">
<div class="modal-content">

<h3 style="margin-bottom:15px;">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>

<input type="text" id="productName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<input type="number" id="productPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<input type="file" id="productImage">

<button class="btn btn-primary" onclick="addProduct()">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
<p onclick="closeM('productModal')" style="text-align:center;margin-top:10px;cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</p>

</div>
</div>

<div id="floatingAddBtn" onclick="openM('productModal')">ï¼‹</div>

<script type="module">
import { createClient } from 'https://jspm.dev/@supabase/supabase-js'

const supabase = createClient(
'https://jgmebfsgdwipovwlrqkb.supabase.co',
'sb_publishable_iD-P4dJjZV32-vZldYMZig_VNV2kMHZ'
);

window.openM=(id)=>document.getElementById(id).style.display='flex';
window.closeM=(id)=>document.getElementById(id).style.display='none';

/* ØªØ³Ø¬ÙŠÙ„ Ø£Ùˆ Ø¯Ø®ÙˆÙ„ */
window.handleAuth=async()=>{
const name=document.getElementById('regName').value.trim();
const role=document.getElementById('regRole').value;
const email=document.getElementById('authEmail').value.trim();
const pass=document.getElementById('authPass').value.trim();

if(!email||!pass)return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");

if(name){
const {data,error}=await supabase.auth.signUp({email,password:pass});
if(error)return alert(error.message);

await supabase.from('profiles').insert([
{id:data.user.id,full_name:name,role:role}
]);

alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ…");
}else{
const {error}=await supabase.auth.signInWithPassword({email,password:pass});
if(error)return alert(error.message);
alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ğŸ‰");
}

closeM('authModal');
};

/* ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ */
window.logout=async()=>{
await supabase.auth.signOut();
};

/* Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ */
window.addProduct=async()=>{
const {data:{user}}=await supabase.auth.getUser();
if(!user)return alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");

const name=document.getElementById('productName').value;
const price=document.getElementById('productPrice').value;
const file=document.getElementById('productImage').files[0];

if(!name||!price||!file)return alert("Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

const fileName=Date.now()+"_"+file.name;

await supabase.storage.from('products').upload(fileName,file);

const {data}=supabase.storage.from('products').getPublicUrl(fileName);

await supabase.from('products').insert([
{name,price,image_url:data.publicUrl,seller_id:user.id}
]);

alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬");
closeM('productModal');
loadProducts();
};

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
async function loadProducts(){
const {data}=await supabase.from('products').select('*');
const container=document.getElementById('productsContainer');
container.innerHTML="";
data.forEach(p=>{
container.innerHTML+=`
<div class="card">
<img src="${p.image_url}">
<h3>${p.name}</h3>
<div class="price">${p.price} Ø±ÙŠØ§Ù„</div>
</div>
`;
});
}

/* ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© */
async function updateUI(){
const {data:{user}}=await supabase.auth.getUser();
if(user){
document.getElementById('navActions').style.display='none';
document.getElementById('userProfile').style.display='block';

const {data:profile}=await supabase.from('profiles').select('role').eq('id',user.id).single();
if(profile?.role==="seller"){
document.getElementById('floatingAddBtn').style.display='flex';
}
}else{
document.getElementById('navActions').style.display='block';
document.getElementById('userProfile').style.display='none';
document.getElementById('floatingAddBtn').style.display='none';
}
}

supabase.auth.onAuthStateChange(()=>updateUI());

loadProducts();
updateUI();
</script>

</body>
</html>
