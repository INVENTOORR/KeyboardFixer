<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø®ÙŠØ±Ø§ØªÙ†Ø§ | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #27ae60; --accent: #f39c12; --bg: #f8fafc; --text: #1e293b; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; }
        body { background: var(--bg); padding-top: 90px; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø«Ø§Ø¨Øª */
        header {
            background: white; height: 80px; position: fixed; top: 0; width: 100%; 
            z-index: 9999; display: flex; justify-content: space-between; align-items: center; 
            padding: 0 5%; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†Ø¸Ù…Ø© */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 10000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; }
        
        .auth-tabs { display: flex; gap: 10px; margin-bottom: 20px; background: #f1f5f9; padding: 5px; border-radius: 12px; }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; border-radius: 10px; font-weight: bold; }
        .tab.active { background: white; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        input, select { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 10px; border: 2px solid #eee; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--primary); }
        .btn-block { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 1rem; }
        
        /* Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù… Ù„Ù„Ø¨Ø§Ø¦Ø¹ */
        #floatingAddBtn {
            position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; 
            background: var(--accent); color: white; border-radius: 50%; 
            display: none; align-items: center; justify-content: center; font-size: 1.5rem;
            cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 9000;
        }
    </style>
</head>
<body>

<header>
    <div style="font-size: 1.8rem; font-weight: 800; color: var(--primary);">Ø®ÙŠØ±Ø§ØªÙ†Ø§ ğŸŒ¿</div>
    <div id="navActions">
        <button class="btn-block" style="padding: 8px 20px;" onclick="openM('authModal')">Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„</button>
    </div>
    <div id="userProfile" style="display: none;">
        <button onclick="openM('profileModal')" style="background:none; border:none; cursor:pointer; font-size:1.5rem;">ğŸ‘¤</button>
    </div>
</header>

<div id="authModal" class="modal">
    <div class="modal-content">
        <div class="auth-tabs">
            <div id="tabL" class="tab active" onclick="switchAuth('login')">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</div>
            <div id="tabR" class="tab" onclick="switchAuth('reg')">Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</div>
        </div>

        <div id="regFields" style="display: none;">
            <input type="text" id="regName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
            <select id="regRole">
                <option value="user">Ø£Ù†Ø§ Ø²Ø¨ÙˆÙ†</option>
                <option value="seller">Ø£Ù†Ø§ Ø¨Ø§Ø¦Ø¹ (Ø£Ø³Ø±Ø© Ù…Ù†ØªØ¬Ø©)</option>
            </select>
        </div>

        <input type="email" id="authEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="authPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"> <button class="btn-block" onclick="handleAuth()">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
        <p onclick="closeM('authModal')" style="text-align:center; margin-top:15px; cursor:pointer; color:#999;">Ø¥Ù„ØºØ§Ø¡</p>
    </div>
</div>

<div id="floatingAddBtn" onclick="alert('Ø³ÙŠÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬')">ï¼‹</div>

<script type="module">
    import { createClient } from 'https://jspm.dev/@supabase/supabase-js'
    const supabase = createClient('https://jgmebfsgdwipovwlrqkb.supabase.co', 'sb_publishable_iD-P4dJjZV32-vZldYMZig_VNV2kMHZ')

    window.openM = (id) => document.getElementById(id).style.display = 'flex';
    window.closeM = (id) => document.getElementById(id).style.display = 'none';

    window.switchAuth = (mode) => {
        const isReg = mode === 'reg';
        document.getElementById('regFields').style.display = isReg ? 'block' : 'none';
        document.getElementById('tabR').classList.toggle('active', isReg);
        document.getElementById('tabL').classList.toggle('active', !isReg);
    }

    window.handleAuth = async () => {
        const email = document.getElementById('authEmail').value;
        const pass = document.getElementById('authPass').value;
        const isReg = document.getElementById('regFields').style.display === 'block';

        if(!email || !pass) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø®Ø§Ù†Ø§Øª");

        try {
            if(isReg) {
                const name = document.getElementById('regName').value;
                const role = document.getElementById('regRole').value;
                const { data, error } = await supabase.auth.signUp({ email, password: pass });
                if(error) throw error;
                await supabase.from('profiles').insert([{ id: data.user.id, full_name: name, role: role }]);
                alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.");
                switchAuth('login');
            } else {
                const { error } = await supabase.auth.signInWithPassword({ email, password: pass });
                if(error) throw error;
                alert("ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
                location.reload(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ù„ØªÙØ¹ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            }
        } catch (err) { alert("Ø®Ø·Ø£: " + err.message); }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    async function checkUser() {
        const { data: { user } } = await supabase.auth.getUser();
        if(user) {
            document.getElementById('navActions').style.display = 'none';
            document.getElementById('userProfile').style.display = 'block';
            
            // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù„Ù…Ø¹Ø±ÙØ© Ù‡Ù„ Ù‡Ùˆ Ø¨Ø§Ø¦Ø¹
            const { data: profile } = await supabase.from('profiles').select('role').eq('id', user.id).single();
            if(profile?.role === 'seller') {
                document.getElementById('floatingAddBtn').style.display = 'flex';
            }
        }
    }
    checkUser();
</script>
</body>
</html>
