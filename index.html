<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø®ÙŠØ±Ø§ØªÙ†Ø§ | Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root { 
    --primary: #27ae60; --accent: #f39c12; --bg: #f8fafc; --text: #1e293b; --radius:20px; --shadow:0 10px 30px rgba(0,0,0,0.1);
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Cairo',sans-serif;}
body{background:var(--bg);color:var(--text);padding-top:90px;min-height:100vh;}
header{background:white;height:80px;position:fixed;top:0;width:100%;z-index:9999;display:flex;justify-content:space-between;align-items:center;padding:0 5%;box-shadow:0 2px 15px rgba(0,0,0,0.08);border-bottom:1px solid #eee;}
.logo{font-size:1.8rem;font-weight:800;color:var(--primary);cursor:pointer;}
.nav-controls{display:flex;gap:12px;align-items:center;}
.nav-btn{padding:10px 18px;border-radius:12px;border:none;cursor:pointer;font-weight:600;transition:.3s;display:flex;align-items:center;gap:8px;}
.btn-main{background:var(--primary);color:white;}
.btn-sec{background:var(--primary-light);color:var(--primary);}
#floatingAddBtn{position:fixed;bottom:30px;right:30px;width:65px;height:65px;background:var(--accent);color:white;border-radius:50%;display:none;align-items:center;justify-content:center;font-size:2rem;box-shadow:0 5px 20px rgba(243,156,18,0.4);cursor:pointer;z-index:8000;transition:.3s;}
#floatingAddBtn:hover{transform:scale(1.1);}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:25px;padding:20px 5%;}
.card{background:white;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);transition:.3s;cursor:pointer;}
.card:hover{transform:translateY(-8px);}
.card-img{width:100%;height:200px;object-fit:cover;}
.card-content{padding:15px;}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:10000;align-items:center;justify-content:center;backdrop-filter:blur(5px);}
.modal-content{background:white;padding:30px;border-radius:25px;width:90%;max-width:450px;position:relative;}
.close{position:absolute;top:20px;left:20px;cursor:pointer;font-size:1.5rem;color:#999;}
.btn-block{width:100%;padding:15px;background:var(--primary);color:white;border:none;border-radius:12px;font-weight:700;cursor:pointer;font-size:1.1rem;margin-bottom:10px;}
#cartPanel{position:fixed;top:0;left:-350px;width:320px;height:100%;background:white;z-index:9999;padding:25px;transition:.4s;box-shadow:10px 0 30px rgba(0,0,0,0.1);}
#cartPanel.active{left:0;}
#welcomeOverlay{display:none;position:fixed;inset:0;background:white;z-index:20000;align-items:center;justify-content:center;font-size:2.5rem;font-weight:900;color:var(--primary);}
</style>
</head>
<body>

<div id="welcomeOverlay">Ø­ÙŠØ§ÙƒÙ… Ø§Ù„Ù„Ù‡ ÙÙŠ Ø®ÙŠØ±Ø§ØªÙ†Ø§! ğŸŒ¿</div>

<header>
    <div class="logo" onclick="location.reload()">Ø®ÙŠØ±Ø§ØªÙ†Ø§</div>
    <div class="nav-controls">
        <button class="nav-btn btn-main" onclick="toggleCart()">ğŸ›’ <span id="cartCount">0</span></button>
        <div id="authArea">
            <button class="nav-btn btn-sec" onclick="openModal('authModal')">Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„</button>
        </div>
        <div id="userArea" style="display:none;">
            <button class="nav-btn btn-sec" onclick="openModal('profileModal')">ğŸ‘¤ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</button>
        </div>
    </div>
</header>

<div id="floatingAddBtn" onclick="openModal('addProdModal')" title="Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯">ï¼‹</div>

<div class="grid" id="productsGrid"></div>

<!-- --- Modal ØªØ³Ø¬ÙŠÙ„ Google ÙˆApple --- -->
<div id="authModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('authModal')">Ã—</span>
        <h2 style="text-align:center;margin-bottom:20px;">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h2>
        <button class="btn-block" onclick="signInProvider('google')">ØªØ³Ø¬ÙŠÙ„ Ø¨Ù€ Google</button>
        <button class="btn-block" onclick="signInProvider('apple')">ØªØ³Ø¬ÙŠÙ„ Ø¨Ù€ Apple</button>
    </div>
</div>

<div id="profileModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('profileModal')">Ã—</span>
        <div style="text-align:center;">
            <div style="font-size:3.5rem;">ğŸ‘¤</div>
            <h2 id="profName">...</h2>
            <p id="profRole" style="color:var(--primary);font-weight:bold;margin-top:5px;"></p>
        </div>
        <hr style="margin:20px 0; opacity:0.1;">
        <button class="btn-block" style="background:#e74c3c;" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<script type="module">
import { createClient } from 'https://jspm.dev/@supabase/supabase-js'
const supabase = createClient('https://jgmebfsgdwipovwlrqkb.supabase.co', 'sb_publishable_iD-P4dJjZV32-vZldYMZig_VNV2kMHZ');

let userObj = null, cart = JSON.parse(localStorage.getItem('myCart')) || [];

window.openModal = id => document.getElementById(id).style.display='flex';
window.closeModal = id => document.getElementById(id).style.display='none';
window.toggleCart = () => document.getElementById('cartPanel').classList.toggle('active');

async function signInProvider(provider){
    const { error } = await supabase.auth.signInWithOAuth({ provider });
    if(error) alert(error.message);
}

window.logout = async () => {
    await supabase.auth.signOut();
    location.reload();
};

async function init(){
    const { data:{ user } } = await supabase.auth.getUser();
    if(user){
        const { data:p } = await supabase.from('profiles').select('*').eq('id', user.id).single();
        if(p){
            userObj=p;
            document.getElementById('authArea').style.display='none';
            document.getElementById('userArea').style.display='block';
            document.getElementById('profName').innerText=p.full_name;
            document.getElementById('profRole').innerText=p.role==='seller'?'Ø¨Ø§Ø¦Ø¹ (Ø£Ø³Ø±Ø© Ù…Ù†ØªØ¬Ø©)':'Ø²Ø¨ÙˆÙ†';
            if(p.role==='seller') document.getElementById('floatingAddBtn').style.display='flex';
            if(localStorage.getItem('greetMe')){
                const ov=document.getElementById('welcomeOverlay');
                ov.style.display='flex';
                setTimeout(()=>{ov.style.display='none';localStorage.removeItem('greetMe');},2500);
            }
        }
    }
    loadProducts();
    updateCartUI();
}

// --- Ø¨Ø§Ù‚ÙŠ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø³Ù„Ø© ÙƒÙ…Ø§ Ù‡ÙŠ ---
async function loadProducts(){
    const { data } = await supabase.from('products').select('*').order('created_at',{ascending:false});
    const grid = document.getElementById('productsGrid');
    grid.innerHTML='';
    data?.forEach(p=>{
        const card=document.createElement('div');
        card.className='card';
        card.innerHTML=`
            <img src="${p.image_url}" class="card-img" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
            <div class="card-content">
            <span style="color:var(--primary); font-size:0.8rem; font-weight:bold;">Ø£Ø³Ø±Ø©: ${p.seller_name}</span>
            <h3 style="margin:5px 0">${p.name}</h3>
            <strong style="color:var(--accent)">${p.price} Ø±ÙŠØ§Ù„</strong>
            </div>`;
        card.onclick=()=>openDetails(p);
        grid.appendChild(card);
    });
}

window.openDetails = (p)=>{
    alert(`ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬: ${p.name}`);
}

window.addToCart = (item)=>{
    cart.push(item);
    localStorage.setItem('myCart',JSON.stringify(cart));
    updateCartUI();
    window.toggleCart();
}

function updateCartUI(){
    document.getElementById('cartCount').innerText=cart.length;
}

init();
</script>
</body>
</html>
